unit uRemoverItemDaVendaUseCase;

interface

uses
  uVenda, uRepositorioVenda;

type
  TRemoverItemDaVendaRequest = record
    VendaId: string;
    ItemId: string;
  end;

  TRemoverItemDaVendaResponse = record
    Venda: TVenda;
  end;

  IRemoverItemDaVendaUseCase = interface
    ['{0EC7D2F9-2518-43B3-8C45-A05342A7DA80}']
    function Executar(const AReq: TRemoverItemDaVendaRequest): TRemoverItemDaVendaResponse;
  end;

  TRemoverItemDaVendaUseCase = class(TInterfacedObject, IRemoverItemDaVendaUseCase)
  private
    FRepoVenda: IRepositorioVenda;
  public
    constructor Create(AVendaRepo: IRepositorioVenda);

    function Executar(const AReq: TRemoverItemDaVendaRequest): TRemoverItemDaVendaResponse;
  end;

implementation

uses
  System.SysUtils;

{ TRemoverItemDaVendaUseCase }

constructor TRemoverItemDaVendaUseCase.Create(AVendaRepo: IRepositorioVenda);
begin
  FRepoVenda := AVendaRepo;
end;

function TRemoverItemDaVendaUseCase.Executar(
  const AReq: TRemoverItemDaVendaRequest): TRemoverItemDaVendaResponse;
var
  Venda: TVenda;
begin
  Venda := FRepoVenda.BuscarPorId(AReq.VendaId);

  if not Assigned(Venda) then
    raise Exception.Create('Venda não encontrada.');

  Venda.RemoverItem(AReq.ItemId);

  Result.Venda := Venda;
end;

end.

